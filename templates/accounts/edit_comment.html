{% extends 'base.html' %}

{% block content %}
  <h2>💬 コメント編集画面</h2>

  <form method="post">
    {% csrf_token %}

    <label for="id_content">🧡 コメント内容：</label><br>
    <textarea id="id_content" name="content" rows="4" maxlength="150" placeholder="例）段ボールの中身はマジックで大きく書くと、開封のとき楽でしたよ">{{ form.content.value }}</textarea><br>
    <small><span id="char-count">0</span>/150文字</small>
    <br><br>

    <label>👤 投稿者表示設定：</label><br>
    <input type="radio" name="display_name" value="True" {% if form.is_displayed.value == "True" %}checked{% endif %}> ニックネームで表示する<br>
    <input type="radio" name="display_name" value="False" {% if form.is_displayed.value == "False" %}checked{% endif %}> 投稿者名を非表示にする（匿名ではありません）<br><br>

    <button type="submit" name="save">✅ 保存</button>
    <button type="button" onclick="openModal()">🗑️ 削除</button>
  </form>

  <div id="deleteModal" class="modal">
  <div class="modal-content">
    <p>このコメントを削除しますか？</p>
    <form method="post" style="display:inline;">
      {% csrf_token %}
      <button type="submit" name="delete">削除する</button>
    </form>
    <button onclick="closeModal()">キャンセル</button>
  </div>
</div>
<style>
.modal {
  display: none;
  position: fixed;
  z-index: 999;
  left: 0; top: 0; width: 100%; height: 100%;
  background-color: rgba(0,0,0,0.5);
}
.modal-content {
  background: white;
  padding: 20px;
  margin: 20% auto;
  width: 300px;
  text-align: center;
  border-radius: 8px;
}
</style>
<script>
function openModal() {
  document.getElementById('deleteModal').style.display = 'block';
}
function closeModal() {
  document.getElementById('deleteModal').style.display = 'none';
}
</script>

  <p><a href="{% url 'accounts:comment_history' %}">戻る</a></p>

  <script>
    // 文字数カウント機能
    const textarea = document.getElementById('id_content');
    const charCount = document.getElementById('char-count');

    function updateCharCount() {
      charCount.textContent = textarea.value.length;
    }

    textarea.addEventListener('input', updateCharCount);
    window.addEventListener('DOMContentLoaded', updateCharCount);
  </script>
{% endblock %}
