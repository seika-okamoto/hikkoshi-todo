{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/mypage.css' %}">
{% endblock %}

{% block content %}
<div class="mypage-wrapper">
 <!-- âœ… æ å†…å·¦ä¸Šã«ã€Œâ† æˆ»ã‚‹ã€ -->
  <p class="back-link-inside">
    <a href="{% url 'home:index' %}">â† æˆ»ã‚‹</a>
  <h2>ãƒã‚¤ãƒšãƒ¼ã‚¸</h2>

<div class="info-row">
  <span class="info-label">ğŸ‘¤ ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼š</span>
  <span class="info-value">{{ profile.user.username }}</span>
  <a href="javascript:void(0)" class="edit-link" id="editUsernameBtn">ç·¨é›†ã™ã‚‹</a>
</div>

<div class="info-row">
  <span class="info-label">ğŸ“§ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼š</span>
  <span class="info-value">{{ profile.user.email }}</span>
  <a class="edit-link" href="{% url 'accounts:edit_email' %}">å¤‰æ›´ã™ã‚‹</a>
</div>

  <p class="info-line">ğŸ“… å¼•ã£è¶Šã—äºˆå®šæ—¥ï¼š{{ profile.planned_move_date|default:"æœªè¨­å®š" }}</p>

  <div class="button-box">
    <a href="{% url 'accounts:change_password' %}">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹</a>
  </div>
  <div class="button-box">
    <a href="{% url 'accounts:comment_history' %}">è‡ªåˆ†ã®ã‚³ãƒ¡ãƒ³ãƒˆå±¥æ­´ã‚’è¦‹ã‚‹</a>
  </div>
  <div class="button-box">
    <a href="{% url 'accounts:about_app' %}">ã€Œã²ã£ã“ã—ToDoã€ã«ã¤ã„ã¦</a>
  </div>

  <div class="button-box logout">
    <button id="logoutBtn">ğŸš« ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã™ã‚‹</button>
  </div>


  <!-- ä»¥ä¸‹ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆJSã¯ãã®ã¾ã¾ï¼‰ -->
  <div id="overlay"></div>
  <div id="editDialog" style="display:none; border:1px solid #ccc; padding:10px; margin:10px 0;">
    <form method="POST" action="{% url 'accounts:edit_username' %}">
      {% csrf_token %}
      <label>ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã‚’ç·¨é›†ã—ã¦ãã ã•ã„</label><br>
      <input type="text" name="username" value="{{ profile.user.username }}"><br>
      <button type="submit">ä¿å­˜</button>
      <button type="button" id="cancelEdit">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </form>
  </div>

  <div id="logoutDialog" style="display:none; border:1px solid #ccc; padding:10px; background:#f9f9f9; margin-top:10px;">
    <p>ğŸš« ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ</p>
    <button id="confirmLogout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
    <button id="cancelLogout">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
  </div>
</div>

<script>
document.getElementById('editUsernameBtn')?.addEventListener('click', function(e) {
    e.preventDefault();
    document.getElementById('editDialog').style.display = 'block';
    document.getElementById('overlay').style.display = 'block';
});

  document.getElementById('cancelEdit')?.addEventListener('click', function() {
    document.getElementById('editDialog').style.display = 'none';
    document.getElementById('overlay').style.display = 'none';
});


  document.getElementById('logoutBtn')?.addEventListener('click', function() {
    document.getElementById('logoutDialog').style.display = 'block';
  });

  document.getElementById('cancelLogout')?.addEventListener('click', function() {
    document.getElementById('logoutDialog').style.display = 'none';
  });

  document.getElementById('confirmLogout')?.addEventListener('click', function() {
    window.location.href = "{% url 'accounts:logout' %}";
  });
</script>
{% endblock %}
