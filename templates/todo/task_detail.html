{% extends 'base.html' %}

{% block content %}
  <p><a href="{% url 'todo:index' %}">ğŸ”™æˆ»ã‚‹</a></p>

  <h2>{{ task.title }}</h2>

  <!-- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆãƒœã‚¿ãƒ³ -->
  <p>
    <a href="?view=memo" {% if view == "memo" %}style="font-weight:bold;"{% endif %}>ãƒ¡ãƒ¢</a> |
    <a href="?view=comment" {% if view == "comment" %}style="font-weight:bold;"{% endif %}>ã‚³ãƒ¡ãƒ³ãƒˆ</a>
  </p>

  <!-- è¡¨ç¤ºå†…å®¹ -->
  {% if view == "memo" %}
    <h3>ãƒ¡ãƒ¢</h3>
    <ul>
      {% for memo in memos %}
        <li>{{ memo.context }}ï¼ˆ{{ memo.created|date:"Y/m/d H:i" }}ï¼‰</li>
    {% empty %}
      <li>ãƒ¡ãƒ¢ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
      {% endfor %}
    </ul>
    <form method="POST" action="{% url 'todo:add_memo' task.id %}">
        {% csrf_token %}
        <textarea name="context" rows="3" cols="40" placeholder="ãƒ¡ãƒ¢ã‚’å…¥åŠ›"></textarea>
        <br>
        <button type="submit">+ ãƒ¡ãƒ¢ã‚’è¿½åŠ </button>
      </form>
    {% endif %}

{% if view == "comment" %}
  <h3>ã‚³ãƒ¡ãƒ³ãƒˆ</h3>
  <ul>
    {% for comment in comments %}
      <li>
        {% if comment.display_name == 'nickname' %}
          æŠ•ç¨¿è€…: {{ comment.user.username }}
        {% else %}
          æŠ•ç¨¿è€…: éå…¬é–‹
        {% endif %}
        <br>
        {{ comment.content }}ï¼ˆ{{ comment.created_at|date:"Y/m/d H:i" }}ï¼‰

        <!-- ã„ã„ã­è¡¨ç¤º -->
        <form method="POST" action="{% url 'todo:toggle_like' comment.id %}" style="display:inline;">
          {% csrf_token %}
          {% with comment.likes.count as like_count %}
            {% if like_count > 0 %}
              <button type="submit">ğŸ‘ {{ like_count }} ã„ã„ã­</button>
            {% else %}
              <button type="submit">ğŸ‘ ã„ã„ã­</button>
            {% endif %}
          {% endwith %}
        </form>
      </li>
    {% empty %}
      <li>ã‚³ãƒ¡ãƒ³ãƒˆã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
    {% endfor %}
  </ul>

  <form method="POST" action="{% url 'todo:add_comment' task.id %}">
    {% csrf_token %}
    <textarea name="content" rows="3" cols="40" placeholder="ã‚³ãƒ¡ãƒ³ãƒˆã‚’å…¥åŠ›"></textarea>
    <br>

    <p>æŠ•ç¨¿è€…è¡¨ç¤ºè¨­å®šï¼š</p>
    <label><input type="radio" name="display_name" value="nickname" checked> ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã§è¡¨ç¤º</label><br>
    <label><input type="radio" name="display_name" value="anonymous"> éå…¬é–‹ã§è¡¨ç¤º</label><br>

    <button type="submit">+ ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ </button>
  </form>
{% endif %}

{% endblock %}
