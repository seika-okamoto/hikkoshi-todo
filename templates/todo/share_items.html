{% extends 'base.html' %}

{% block content %}
<h2>ğŸ”— å…±æœ‰ã™ã‚‹é …ç›®</h2>

{% if tasks %}
  <ul>
    {% for task in tasks %}
      <li>ãƒ»{{ task.title }}</li>
    {% endfor %}
  </ul>

  <button id="copyBtn">ã“ã®å†…å®¹ã§å…±æœ‰</button>
{% else %}
  <p>æœªå®Œäº†ã®ã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
{% endif %}

<p><a href="{% url 'todo:index' %}">å…±æœ‰ã‚’ã‚„ã‚ã¦æˆ»ã‚‹</a></p>

<script>
  document.getElementById('copyBtn').addEventListener('click', function () {
  const text = Array.from(document.querySelectorAll('li'))
                    .map(li => li.innerText)
                    .join('\n');

  const isMobile = /iPhone|Android.+Mobile/.test(navigator.userAgent);

  if (navigator.share && isMobile) {
    navigator.share({
      title: 'å¼•ã£è¶Šã—ToDoãƒªã‚¹ãƒˆï¼ˆæœªå®Œäº†ï¼‰',
      text: text,
    }).catch(err => {
      console.log('å…±æœ‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«:', err);
      // fallback
      navigator.clipboard.writeText(text).then(() => {
        alert('ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼ï¼ˆLINEãªã©ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼‰');
      });
    });
  } else {
    navigator.clipboard.writeText(text).then(() => {
      alert('ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼ï¼ˆLINEãªã©ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼‰');
    });
  }
});

</script>
{% endblock %}
