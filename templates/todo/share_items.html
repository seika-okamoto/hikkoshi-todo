{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/share_items.css' %}">
{% endblock %}

{% block content %}
<div class="comment-history-wrapper">
    <!-- âœ… æ å†…å·¦ä¸Šã«ã€Œâ† æˆ»ã‚‹ã€ -->
  <p class="back-link-inside">
    <a href="{% url 'todo:index' %}">â† æˆ»ã‚‹</a>
  </p> 
<h2>ğŸ”— å…±æœ‰ã™ã‚‹é …ç›®</h2>

{% if tasks %}
  <ul>
    {% for task in tasks %}
      <li>{{ task.title }}</li>
    {% endfor %}
  </ul>

  <div class="share-buttons">
    <button id="copyBtn">ã“ã®å†…å®¹ã§å…±æœ‰</button>
  </div>
  <div style="text-align: center; margin-top: 24px;">
    <a href="{% url 'todo:index' %}" class="back-link">å…±æœ‰ã‚’ã‚„ã‚ã¦æˆ»ã‚‹</a>
  </div>

{% else %}
  <p class="center-text">æœªå®Œäº†ã®ã‚¿ã‚¹ã‚¯ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚</p>
{% endif %}

<script>
  document.getElementById('copyBtn').addEventListener('click', function () {
    const text = Array.from(document.querySelectorAll('li'))
                      .map(li => li.innerText)
                      .join('\n');

    const isMobile = /iPhone|Android.+Mobile/.test(navigator.userAgent);

    if (navigator.share && isMobile) {
      navigator.share({
        title: 'å¼•ã£è¶Šã—ToDoãƒªã‚¹ãƒˆï¼ˆæœªå®Œäº†ï¼‰',
        text: text,
      }).catch(err => {
        console.log('å…±æœ‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«:', err);
        navigator.clipboard.writeText(text).then(() => {
          alert('ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼ï¼ˆLINEãªã©ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼‰');
        });
      });
    } else {
      navigator.clipboard.writeText(text).then(() => {
        alert('ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼ï¼ˆLINEãªã©ã«è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ï¼‰');
      });
    }
  });
</script>
{% endblock %}
