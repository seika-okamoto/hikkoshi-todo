{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/todo_edit.css' %}">
{% endblock %}

{% block content %}
<script>
  // ğŸ”’ base.htmlã‚ˆã‚Šã‚‚å‰ã«å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼
  window.disableOverlayClose = true;
</script>
<div class="comment-history-wrapper">
  <!-- â† æˆ»ã‚‹ -->
  <p class="back-link-inside">
    <a href="{% url 'todo:index' %}">â† æˆ»ã‚‹</a>
  </p>

  <div class="todo-title-row">
    <h2 class="todo-title">ToDoï¼ˆç·¨é›†ãƒ»è¿½åŠ ãƒ¢ãƒ¼ãƒ‰ï¼‰</h2>
    <div class="action-buttons">
      <a href="{% url 'todo:add_task' %}">â•è¿½åŠ </a>
    </div>
  </div>

  {% for cat_name, cat_tasks in grouped_tasks.items %}
    <div class="task-section">
      <h3>{{ cat_name }}</h3> 
      {% for task in cat_tasks %}
        <div class="task-card">
          <div class="task-left">
            <input type="checkbox" {% if task.is_done %}checked{% endif %} disabled>
            <span class="task-title">{{ task.title }}</span>
          </div>

        {% if not task.is_template %}
          <div class="task-actions">
            <button class="edit-btn" data-task-id="{{ task.id }}">âœï¸</button>
            <button class="delete-btn" data-task-id="{{ task.id }}">ğŸ—‘</button>
          </div>
        {% else %}
          <div class="task-actions">
            <span class="template-label">ğŸ”’</span>
          </div>
        {% endif %}
      </div>


      {% if not task.is_template %}
        <!-- ç·¨é›†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
        <div class="modal edit-modal" id="edit-modal-{{ task.id }}" style="display:none;">
          <p class="modal-title">å†…å®¹ã‚’ç·¨é›†ã—ã¦ãã ã•ã„</p>
          <form method="POST" action="{% url 'todo:edit_task' task.id %}">
            {% csrf_token %}
            <input type="text" name="title" value="{{ task.title }}">
            <button type="submit">âœ…ä¿å­˜</button>
            <button type="button" class="cancel-btn">âŒã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
          </form>
        </div>

      <!-- å‰Šé™¤ãƒ¢ãƒ¼ãƒ€ãƒ« -->
      <div class="modal delete-modal" id="delete-modal-{{ task.id }}" style="display:none;">
        <p style="margin-bottom: 16px;">ã“ã®é …ç›®ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</p>
        <form method="POST" action="{% url 'todo:delete_task' task.id %}">
          {% csrf_token %}
          <button type="submit">ğŸ—‘ï¸å‰Šé™¤</button>
          <button type="button" class="cancel-btn">âŒã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
        </form>
      </div>
      {% endif %}
    {% endfor %}
  {% endfor %}
</div>

<!-- ãƒ¢ãƒ¼ãƒ€ãƒ«åˆ¶å¾¡ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.edit-btn').forEach(button => {
    button.addEventListener('click', () => {
      const id = button.dataset.taskId;
      document.getElementById(`edit-modal-${id}`).style.display = 'block';
      document.getElementById('overlay').style.display = 'block';  // â† ã“ã‚Œè¿½åŠ ï¼ï¼
    });
  });

  document.querySelectorAll('.delete-btn').forEach(button => {
    button.addEventListener('click', () => {
      const id = button.dataset.taskId;
      document.getElementById(`delete-modal-${id}`).style.display = 'block';
      document.getElementById('overlay').style.display = 'block';  // â† ã“ã‚Œè¿½åŠ ï¼ï¼
    });
  });

  document.querySelectorAll('.cancel-btn').forEach(button => {
    button.addEventListener('click', () => {
      button.closest('.modal').style.display = 'none';
      document.getElementById('overlay').style.display = 'none';  // â† ã“ã“é‡è¦ï¼
    });
  });

});
</script>

{% endblock %}

<div id="overlay"></div>