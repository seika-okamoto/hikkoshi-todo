{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/todo_edit.css' %}">
{% endblock %}

{% block content %}
<div class="comment-history-wrapper">
    <!-- âœ… æ å†…å·¦ä¸Šã«ã€Œâ† æˆ»ã‚‹ã€ -->
  <p class="back-link-inside">
    <a href="{% url 'todo:index' %}">â† æˆ»ã‚‹</a>
  </p>  

<div class="todo-header">
  <h2 class="todo-title">ToDoï¼ˆç·¨é›†ãƒ¢ãƒ¼ãƒ‰ï¼‰</h2>
  <a href="{% url 'todo:add_task' %}" class="add-btn">â•</a>
</div>

{% for task in tasks %}
  <div class="task-card">
    <div class="task-left">
      <span class="task-title">{{ task.title }}</span>
    </div>
    <div class="task-actions">
      <button class="edit-btn" data-task-id="{{ task.id }}">âœï¸</button>
      <button class="delete-btn" data-task-id="{{ task.id }}">ğŸ—‘</button>
    </div>
  </div>

  <!-- ç·¨é›†ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal edit-modal" id="edit-modal-{{ task.id }}" style="display:none;">
    <p class="modal-title">å†…å®¹ã‚’ç·¨é›†ã—ã¦ãã ã•ã„</p>
    <form method="POST" action="{% url 'todo:edit_task' task.id %}">
      {% csrf_token %}
      <input type="text" name="title" value="{{ task.title }}">
      <button type="submit">ä¿å­˜</button>
      <button type="button" class="cancel-btn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </form>
  </div>

  <!-- å‰Šé™¤ç”¨ãƒ¢ãƒ¼ãƒ€ãƒ« -->
  <div class="modal delete-modal" id="delete-modal-{{ task.id }}" style="display:none;">
    <p style="margin-bottom: 16px;">ã“ã®é …ç›®ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ</p>
    <form method="POST" action="{% url 'todo:delete_task' task.id %}">
      {% csrf_token %}
      <button type="submit">å‰Šé™¤</button>
      <button type="button" class="cancel-btn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </form>
  </div>
{% endfor %}

<!-- âœ…ã“ã“ã«ç§»å‹• -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.edit-btn').forEach(button => {
    button.addEventListener('click', () => {
      const id = button.dataset.taskId;
      document.getElementById(`edit-modal-${id}`).style.display = 'block';
    });
  });

  document.querySelectorAll('.delete-btn').forEach(button => {
    button.addEventListener('click', () => {
      const id = button.dataset.taskId;
      document.getElementById(`delete-modal-${id}`).style.display = 'block';
    });
  });

  document.querySelectorAll('.cancel-btn').forEach(button => {
    button.addEventListener('click', () => {
      button.closest('.modal').style.display = 'none';
    });
  });
});
</script>
{% endblock %}
